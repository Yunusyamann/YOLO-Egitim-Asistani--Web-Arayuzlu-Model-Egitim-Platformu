{% extends "trainer/base.html" %}

{% block title %}GÃ¶rev #{{ job.id }} Durumu{% endblock %}

{% block content %}

{% if job.status == 'RUNNING' or job.status == 'PENDING' %}
    <meta http-equiv="refresh" content="30">
{% endif %}

<div class="card shadow-sm">
    <div class="card-header bg-dark text-white">
        <h4 class="my-0">GÃ¶rev #{{ job.id }} - Durum:
            {% if job.status == 'COMPLETED' %}<span class="badge bg-success">TamamlandÄ±</span>
            {% elif job.status == 'RUNNING' %}<span class="badge bg-info">EÄŸitiliyor...</span>
            {% elif job.status == 'PENDING' %}<span class="badge bg-warning text-dark">SÄ±rada Bekliyor...</span>
            {% elif job.status == 'FAILED' %}<span class="badge bg-danger">Hata OluÅŸtu</span>
            {% endif %}
        </h4>
    </div>
    <div class="card-body">
        <div class="row mb-3">
            <div class="col-md-6"><strong>Model:</strong> {{ job.get_selected_model_display }}</div>
            <div class="col-md-6"><strong>Epochs:</strong> {{ job.epochs }}</div>
        </div>
        <p class="text-muted"><strong>BaÅŸlatma ZamanÄ±:</strong> {{ job.created_at|date:"d M Y, H:i" }}</p>

        {% if job.status == 'RUNNING' or job.status == 'PENDING' %}
            <div class="d-flex justify-content-center align-items-center my-4">
                <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">YÃ¼kleniyor...</span>
                </div>
                <strong class="ms-3 fs-5">EÄŸitim Devam Ediyor...</strong>
            </div>
            <div class="alert alert-light mt-3 border-0">Sayfa sonucu gÃ¶rmek iÃ§in periyodik olarak kendini yenileyecektir.</div>
        {% endif %}

        {% if job.status == 'COMPLETED' %}
            {% with results=job.get_results_summary %}
                {% if results %}
                    <div class="alert alert-success">EÄŸitim baÅŸarÄ±yla tamamlandÄ±!</div>
                    <h5 class="mt-4">ðŸ“ˆ EÄŸitim Grafikleri</h5>
                    <hr>
                    <div class="row text-center g-3">
                        {% for name, url in results.images.items %}
                        <div class="col-md-4">
                            <a href="{{ url }}" target="_blank"><img src="{{ url }}" class="img-fluid rounded shadow-sm" alt="{{ name }}"></a>
                        </div>
                        {% endfor %}
                    </div>
                    <h5 class="mt-4">ðŸ“Š Metrikler</h5>
                    <hr>
                    {% if results.csv_data %}<div class="table-responsive">{{ results.csv_data|safe }}</div>{% endif %}
                {% endif %}
            {% endwith %}
        {% endif %}

        {% if job.status == 'FAILED' %}
            <div class="alert alert-danger"><h4>EÄŸitim SÄ±rasÄ±nda Bir Hata OluÅŸtu</h4><p>Daha fazla bilgi iÃ§in sunucu loglarÄ±nÄ± kontrol edin.</p></div>
        {% endif %}
    </div>
</div>
{% endblock %}